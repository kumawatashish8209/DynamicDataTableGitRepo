<!--
  @description       : 
  @author            : ChangeMeIn@UserSettingsUnder.SFDoc
  @group             : 
  @last modified on  : 09-08-2025
  @last modified by  : ChangeMeIn@UserSettingsUnder.SFDoc
-->

<template>
    <template if:true={isLoading}>
        <lightning-spinner alternative-text="Loading" size="medium"></lightning-spinner>
    </template>
    <div class="slds-m-around_medium slds-grid slds-grid_align-spread">
        <lightning-button label="New Contact" variant="brand" onclick={showForm}></lightning-button>
        <lightning-button variant="brand" label="Delete" title="Primary action" onclick={handleDelete}></lightning-button>
    </div>
    <!-- form for add new contact -->
    <template if:true={isVisible}>
        <section role="dialog" tabindex="-1" class="slds-modal slds-fade-in-open">
            <div class="slds-modal__container">
                <header class="slds-modal__header">
                    <h2 class="slds-text-heading_medium">New Contact</h2>
                </header>

                <div class="slds-modal__content slds-p-around_medium">
                    <lightning-input label="Frist Name" value={FirstName} onchange={handleChange} data-id="FirstName"></lightning-input>
                    <lightning-input label="Last Name" value={LastName} onchange={handleChange} data-id="LastName" required ></lightning-input>
                    <lightning-input label="Email" value={Email} onchange={handleChange} data-id="Email" type="email"></lightning-input>
                    <lightning-input label="Phone" value={Phone} onchange={handleChange} data-id="Phone" type="tel"></lightning-input>
                    <lightning-record-picker label="Accounts" placeholder="search account name.." data-id="AccountName" object-api-name="Account" onchange={handleChange}></lightning-record-picker>

                </div>
                
                <footer class="slds-modal__footer slds-grid slds-grid_align-spread">
                    <lightning-button variant="brand" label="Save" onclick={saveContact}></lightning-button>
                    <lightning-button variant="neutral" label="Cancel" onclick={hideForm}></lightning-button>
                </footer>
            </div>
        </section>
        <div class="slds-backdrop slds-backdrop_open"></div>
    </template>

    <!-- form for edit contact using action in different manner -->
      <template if:true={isVisibleEditForm}>
        <section role="dialog" tabindex="-1" aria-modal="true" class="slds-modal slds-fade-in-open">
            <div class="slds-modal__container">
                <header class="slds-modal__header">
                    <h2 class="slds-text-heading_medium slds-hyphenate">Edit Contact</h2>
                </header>

                <div class="slds-modal__content slds-p-around_medium">
                    <lightning-record-edit-form data-id="EditForm" object-api-name='Contact' onsuccess={handleEditForm} record-id={recordId}>
                        <lightning-input-field data-id="FirstName" field-name='FirstName'> </lightning-input-field>
                        <lightning-input-field data-id="LastName" field-name='LastName'> </lightning-input-field>
                        <lightning-input-field data-id="AccountId" field-name='AccountId'> </lightning-input-field>
                        <lightning-input-field data-id="Phone" field-name='Phone'> </lightning-input-field>
                        <lightning-input-field data-id="Email" field-name='Email'> </lightning-input-field>
                        <div class="slds-m-around_medium slds-grid slds-grid_align-spread">
                            <lightning-button data-id="save" variant="brand" type="submit" label="Save"></lightning-button>
                            <lightning-button data-id="cancel" label="Cancel" onclick={handleEditForm}></lightning-button>
                        </div>
                    </lightning-record-edit-form>
                </div>
            </div>
        </section>
        <div class="slds-backdrop slds-backdrop_open"></div>
    </template>

    <!-- Data table of contact -->
    <div style="height: 300px;">
        <div class="slds-col slds-size_4-of-12">
            <lightning-input type="text" placeholder="Search contact by Name.."  onchange={searchByName}>
            </lightning-input>
        </div>
        
        <!-- <lightning-input type="text" label="Enter number of contacts you want to see" placeholder="Enter number of Contacts..."  onkeyup={setCount}>
        </lightning-input> -->
        <div>
            <lightning-datatable    
                key-field="Id"
                data={paginatedData}
                columns={columns} 
                onsave={handleSave} 
                draft-values={drafvals} 
                onrowaction={handleRowAction}
                show-row-number-column>
            </lightning-datatable>
        </div>
        <div class="slds-align_absolute-center slds-m-top_medium">
            <!-- first page -->
            <lightning-button-icon icon-name="utility:jump_to_left" alternative-text="First" title="First Page"
                variant="border-filled" onclick={handleFirst} disabled={isFirstPage}>
            </lightning-button-icon>
            <!-- prev page -->
            <lightning-button-icon icon-name="utility:chevronleft" alternative-text="Previous" title="Previous Page"
                variant="border-filled" onclick={handlePrevious} disabled={isFirstPage}>
            </lightning-button-icon>
            <!-- current page -->
            <span class="slds-text-title_bold slds-m-horizontal_medium">
                Page {pageNumber} of {totalPages}
            </span>
            <!-- next page -->
            <lightning-button-icon icon-name="utility:chevronright" alternative-text="Next" title="Next Page"
                variant="border-filled" onclick={handleNext} disabled={isLastPage}>
            </lightning-button-icon>
            <!-- last page -->
            <lightning-button-icon icon-name="utility:jump_to_right" alternative-text="Last" title="Last Page"
                variant="border-filled" onclick={handleLast} disabled={isLastPage}>
            </lightning-button-icon>
        </div>
    </div>
</template>
